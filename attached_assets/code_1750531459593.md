# Permintaan Replit AI Agent: Aplikasi Chat Gemini Canggih & Profesional (Go + Vanilla JS/CSS) - SANGAT TELITI

Halo Replit AI Agent,

Saya ingin Anda membuat aplikasi web chat interaktif yang canggih dan berfungsi penuh, dengan fokus utama pada **kualitas kode tinggi, pengalaman pengguna yang mulus (smooth UX), dan estetika UI yang modern, profesional, dan minimalis**. Aplikasi ini akan menggunakan **Go (Golang) sebagai backend** dan **HTML, CSS, serta JavaScript murni sebagai frontend**. Aplikasi ini harus sepenuhnya mengintegrasikan **Google Gemini (model `gemini-pro` untuk teks dan `gemini-pro-vision` untuk analisis gambar)**.

**Target Utama (Hasil Akhir yang Diharapkan):**

1.  **Stabilitas & Keandalan (Bug-Free):** Aplikasi harus berfungsi penuh. Gemini harus **selalu merespons** pesan pengguna dengan konteks yang benar, dan alur UI harus mulus tanpa terjebak di layar mana pun atau menunjukkan error yang tidak jelas. Semua transisi harus terjadi pada waktu yang tepat.
2.  **Desain UI Profesional & Modern:** Tampilan yang sangat bersih, minimalis, dan elegan, terinspirasi kuat dari estetika UI aplikasi AI modern dan `reactbits.dev` (namun diimplementasikan **MURNI dengan Vanilla JS/CSS**, tanpa React atau library UI pihak ketiga).
3.  **Animasi Halus & Interaktif:** Implementasi transisi dan animasi harus menggunakan **CSS murni (keyframes, transitions)** dan **JavaScript DOM manipulation** untuk efek fade-in, slide-up, loading state yang menarik, dan interaksi tombol yang responsif.
4.  **Ikon Profesional & Minimalis:** Gunakan **ikon yang sangat sederhana (seperti karakter Unicode yang bisa distyling rapi)** atau hanya **teks** pada tombol. **DILARANG KERAS menggunakan ikon SVG kompleks, emoji yang terkesan "savage" atau "childish", atau gambar bitmap ikon yang tidak terintegrasi dengan desain minimalis.**
5.  **Performa Optimal:** Pastikan kode Go dan JavaScript efisien untuk pengalaman pengguna yang cepat dan responsif.

---

## 1. Struktur Proyek

*   **Backend (Go):**
    *   `main.go`: File utama server Go.
    *   `go.mod` dan `go.sum`: Untuk manajemen dependensi Go.
*   **Frontend (Static Files):**
    *   `public/index.html`: Struktur HTML dasar aplikasi.
    *   `public/style.css`: Styling, palet warna, dan animasi CSS.
    *   `public/script.js`: Logika JavaScript untuk interaksi UI dan komunikasi dengan backend.

---

## 2. Fungsionalitas Backend (`main.go`) - Fokus pada Responsivitas Gemini & Data Handling yang AKURAT

*   **Dependencies:**
    *   Instal dan gunakan `github.com/google/generative-ai-go/genai`.
    *   Gunakan paket standar Go: `net/http`, `os`, `encoding/json`, `io`, `bytes`, `mime/multipart`, `log`, `fmt`.
*   **Server HTTP:**
    *   Buat server HTTP menggunakan `net/http`.
    *   Layanan file statis dari direktori `public/`. Gunakan `http.FileServer` dengan `http.StripPrefix("/public/", http.Dir("public"))` agar aset dapat diakses dari `/public/`. Pastikan `index.html` dapat diakses langsung dari `/`.
    *   Port server harus diambil dari variabel lingkungan `PORT` (e.g., `os.Getenv("PORT")`) atau default ke `8080`.
*   **Endpoint API Chat (`/api/chat`):**
    *   **Metode:** `POST`.
    *   **Input (Sangat Penting: `multipart/form-data` parsing yang teliti):**
        *   Menerima `messages` (string JSON): Ini adalah **seluruh riwayat percakapan dari frontend**, dalam format array objek berikut:
            ```json
            [
              {"role": "user", "parts": [{"text": "Hai!"}]},
              {"role": "model", "parts": [{"text": "Halo juga."}]},
              {"role": "user", "parts": [{"text": "Ini gambar saya.", "mimeType": "image/jpeg", "data": "base64_encoded_image_data_dari_historis"}]},
              {"role": "model", "parts": [{"text": "Gambar bagus."}]}
            ]
            ```
            **Perhatikan:** `data` untuk gambar historis (yang sudah dikirim sebelumnya oleh pengguna atau model) akan selalu berupa **base64-encoded string**. Backend harus mampu mendekode ini.
        *   Menerima `image` (file opsional): File gambar **biner** (belum base64) yang diunggah pengguna untuk **turn percakapan saat ini**.
        *   Menerima `prompt` (string): Teks prompt yang ditulis di `textarea` oleh pengguna untuk turn percakapan saat ini (bisa kosong jika hanya mengirim gambar).
    *   **API Key Gemini:**
        *   Dapatkan API Key dari variabel lingkungan Go: `GEMINI_API_KEY`.
        *   **Sertakan komentar yang sangat jelas** di `main.go` yang menginstruksikan pengguna cara mengatur `GEMINI_API_KEY` di Replit Secrets (misal: "Go to the 'Secrets' tab (lock icon) on the left sidebar, click 'Add new secret', set 'Key' to `GEMINI_API_KEY` and 'Value' to your actual API key from Google AI Studio.").
    *   **Logika Percakapan dan Model Dinamis (SANGAT KRUSIAL untuk Konteks & Respons yang Akurat):**
        *   **Parsing Input Teliti:**
            *   Panggil `r.ParseMultipartForm(10 << 20)` (batas 10MB untuk form data) pada `http.Request` (`r`).
            *   Dapatkan string JSON `messages` dari `r.FormValue("messages")`. **Unmarshal (decode) string JSON ini ke dalam struktur data Go yang sesuai.** Struktur ini harus mencerminkan format `{"role": "...", "parts": [...]}`.
            *   Dapatkan `prompt` teks dari `r.FormValue("prompt")`.
            *   Periksa apakah `image` file diunggah menggunakan `r.FormFile("image")`. Jika ada, baca kontennya ke `[]byte` dan identifikasi `mimeType` (`image/jpeg`, `image/png`, dll.).
        *   **Inisialisasi Client & Model:**
            *   Buat `genai.NewClient()` menggunakan `option.WithAPIKey(apiKey)`.
            *   **Penentuan Model Dinamis:**
                *   Jika `image` file **diunggah untuk permintaan saat ini**: Inisialisasi model `gemini-pro-vision`.
                *   Jika **TIDAK ada `image` file diunggah untuk permintaan saat ini**: Inisialisasi model `gemini-pro`.
        *   **Replikasi Riwayat Percakapan (SANGAT PENTING untuk Konteks):**
            *   Jika menggunakan model `gemini-pro` (untuk chat teks):
                *   Inisialisasi **`genai.ChatSession` baru** dari model yang telah diinisialisasi.
                *   **Iterasi melalui `messages` array historis yang di-parse dari frontend.** Untuk setiap pesan historis (`{"role": "...", "parts": [...]}`):
                    *   Buat array `genai.Part` yang sesuai.
                    *   Jika `part` adalah teks, buat `genai.Text(part.Text)`.
                    *   Jika `part` adalah gambar historis (punya `mimeType` dan `data` base64): **Dekode `part.Data` dari base64 ke `[]byte`**, lalu buat `genai.ImageData(part.MimeType, decodedBytes)`.
                    *   **Penting:** Panggil `session.SendContent(ctx, parts...)` untuk setiap pasangan turn (user-model) dalam riwayat. Pastikan urutan `user` lalu `model` dalam riwayat sesuai dengan ekspektasi Gemini. Ini membangun kembali konteks percakapan di sisi Gemini.
        *   **Kirim Pesan Terbaru (Turn Saat Ini):**
            *   Buat `genai.Part`s untuk konten yang akan dikirim di turn saat ini.
            *   Jika ada `prompt` teks, sertakan `genai.Text(promptText)`.
            *   Jika ada `image` yang diunggah (turn saat ini): sertakan `genai.ImageData(mimeType, imageBytes)`.
            *   Kirim gabungan `genai.Part`s ini ke model yang sesuai (`gemini-pro` melalui `session.SendMessage` atau `gemini-pro-vision` langsung via `model.GenerateContent`).
        *   **Dapatkan Respons & Parsing:** Ambil respons teks dari Gemini.
    *   **Output JSON:**
        *   Tulis respons Gemini (teks) ke `http.ResponseWriter` sebagai JSON: `{"response": "Teks balasan dari Gemini"}`.
    *   **Error Handling (SANGAT KRUSIAL untuk Debugging & UX):**
        *   Tangani semua error secara eksplisit (parsing request, inisialisasi Gemini client, panggilan API, dll.).
        *   **Log error secara detail ke konsol Replit** menggunakan `log.Printf("ERROR: %+v\n", err)` (gunakan `%+v` untuk mendapatkan stack trace atau detail error lengkap).
        *   **Selalu kirim respons error yang informatif ke frontend** dalam format JSON: `{"error": "Pesan error spesifik dari backend (misal: 'Failed to parse request body', 'Gemini API error: [detail dari err]', 'Internal server error')"}`. Setel status HTTP yang sesuai (misal: `http.StatusBadRequest` untuk input yang salah, `http.StatusInternalServerError` untuk error internal).

---

## 3. Fungsionalitas Frontend (`public/index.html`, `public/style.css`, `public/script.js`) - Fokus pada UI/UX & Animasi yang Presisi

### 3.1. `public/index.html`

*   **Struktur HTML5 yang Rapi & Semantik:**
    ```html
    <!DOCTYPE html>
    <html lang="id">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Gemini Chat Clone</title>
        <!-- Link Google Fonts (untuk font 'Inter' yang bersih dan modern) -->
        <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="style.css">
    </head>
    <body>
        <div id="app-container">
            <!-- Header Aplikasi -->
            <header>
                <h1>Gemini Chat</h1>
                <p class="subtitle">Powered by Google Gemini AI</p>
            </header>

            <!-- Layar Selamat Datang (Splash Screen) - Akan disembunyikan oleh JS -->
            <div id="welcome-screen">
                <div class="gemini-sparkle-logo"></div> <!-- Dibuat murni dengan CSS -->
                <h1>Selamat Datang di Gemini Chat</h1>
                <p class="welcome-message-text">Asisten AI canggih dari Google. Tanyakan apa saja atau unggah gambar untuk dianalisis.</p>
            </div>

            <!-- Konten Chat Utama - Awalnya tersembunyi secara visual, akan muncul dengan animasi -->
            <main>
                <div id="chat-container">
                    <!-- Pesan chat akan muncul di sini -->
                </div>
                <div id="loading-indicator">
                    <span>AI is typing</span><span class="dot">.</span><span class="dot">.</span><span class="dot">.</span>
                </div>
                <div id="error-message-area">
                    <!-- Pesan error dari backend akan muncul di sini -->
                </div>
            </main>

            <!-- Area Input Chat (Selalu di Bawah Layar) -->
            <div id="input-area">
                <textarea id="user-input" placeholder="Tulis pesan atau unggah gambar..." rows="1" aria-label="Tulis pesan Anda"></textarea>
                <label for="image-upload" class="icon-button upload-button" title="Unggah Gambar" aria-label="Unggah Gambar">
                    &#128444; <!-- Unicode Picture Frame: &#128444; atau Camera: &#128247; atau Paperclip: &#128206; -->
                    <input type="file" id="image-upload" accept="image/*" style="display: none;">
                </label>
                <button id="send-button" class="icon-button send-button" title="Kirim Pesan" aria-label="Kirim Pesan">
                    &#x27A4; <!-- Unicode Black Right-Pointing Triangle -->
                </button>
            </div>

            <!-- Preview Gambar yang Dipilih - Awalnya tersembunyi secara visual -->
            <div id="image-preview-container">
                <img id="image-preview" alt="Image preview">
                <button id="clear-image-preview" class="icon-button clear-preview-button" title="Hapus Gambar" aria-label="Hapus Gambar">
                    &times; <!-- Unicode Multiplication X -->
                </button>
            </div>
        </div>

        <script src="script.js"></script>
    </body>
    </html>
    ```

### 3.2. `public/style.css`

*   **CSS Reset & Box-sizing (Sangat Penting):**
    ```css
    * { box-sizing: border-box; margin: 0; padding: 0; }
    html, body { height: 100%; margin: 0; font-family: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", sans-serif; -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale; }
    ```
*   **Palet Warna Modern & Minimalis (Definisi Variabel CSS):**
    ```css
    :root {
        --primary-bg: #f8f9fa; /* Light gray background for chat container */
        --secondary-bg: #ffffff; /* White background for header, welcome screen, input area */
        --text-color-dark: #202124; /* Dark text for primary content */
        --text-color-light: #5f6368; /* Gray text for subtitles/placeholders */
        --border-color: #dadce0; /* Subtle border color */
        --bubble-user-bg: #e0e7ff; /* Light blue for user message bubbles */
        --bubble-model-bg: #f1f3f4; /* Light gray for AI message bubbles */
        --accent-color: #4285f4; /* Google Blue for primary actions/buttons */
        --accent-color-dark: #357ae8; /* Darker blue for hover states */
        --error-color: #d32f2f; /* Red for error text */
        --error-bg: #ffebee; /* Light red for error background */
    }
    ```
*   **General Layout (`app-container`):**
    ```css
    #app-container {
        display: flex;
        flex-direction: column;
        height: 100vh;
        background: var(--primary-bg);
        position: relative; /* Untuk welcome-screen absolute */
        overflow: hidden; /* Mencegah scroll yang tidak diinginkan dari welcome-screen */
    }
    ```
*   **Header Aplikasi:**
    ```css
    header {
        background: var(--secondary-bg);
        padding: 15px;
        text-align: center;
        border-bottom: 1px solid var(--border-color);
        box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        z-index: 10;
        position: relative; /* Agar z-index bekerja */
    }
    header h1 {
        font-size: 24px;
        color: var(--text-color-dark);
        font-weight: 500;
        margin-bottom: 4px;
    }
    header .subtitle {
        font-size: 14px;
        color: var(--text-color-light);
    }
    ```
*   **Layar Selamat Datang (`welcome-screen`) Styling & Animasi (SANGAT PENTING):**
    ```css
    #welcome-screen {
        position: absolute;
        top: 0; left: 0; right: 0; bottom: 0;
        background: var(--secondary-bg);
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        padding: 20px;
        z-index: 100; /* Pastikan di atas semua */
        opacity: 1; /* Default visible */
        transform: translateY(0); /* Default position */
        transition: opacity 0.5s ease-out, transform 0.5s ease-out; /* Animasi untuk hide */
        will-change: opacity, transform; /* Optimalisasi */
    }
    #welcome-screen.hidden { /* Kelas ini ditambahkan JS saat menghilang */
        opacity: 0;
        transform: translateY(-20px); /* Efek slide-up saat menghilang */
        pointer-events: none; /* Mencegah interaksi setelah tersembunyi */
    }
    #welcome-screen h1 {
        font-size: 32px;
        color: var(--text-color-dark);
        margin-bottom: 10px;
        font-weight: 600;
    }
    #welcome-screen .welcome-message-text {
        font-size: 18px;
        color: var(--text-color-light);
        max-width: 600px;
        line-height: 1.5;
    }
    /* CSS-Only Gemini Sparkle Logo - Contoh implementasi yang bersih */
    .gemini-sparkle-logo {
        width: 60px; height: 60px;
        position: relative;
        margin-bottom: 25px;
        /* Ini adalah contoh yang perlu disempurnakan oleh AI Agent untuk logo yang lebih presisi dan menarik */
        /* Contoh dasar untuk bintang 4 titik */
        background-color: transparent;
        border-left: 10px solid transparent;
        border-right: 10px solid transparent;
        border-bottom: 18px solid #FFC107; /* Warna kuning */
        transform: rotate(35deg);
        box-shadow: 0 0 15px rgba(255, 193, 7, 0.5); /* Soft glow */
    }
    .gemini-sparkle-logo::before, .gemini-sparkle-logo::after {
        content: '';
        position: absolute;
        background-color: #FFC107;
        box-shadow: 0 0 10px rgba(255, 193, 7, 0.4);
    }
    .gemini-sparkle-logo::before { /* Bagian kedua sparkle utama */
        width: 60px; height: 60px;
        border-radius: 50%; /* Contoh sederhana, bisa lebih kompleks */
        top: -10px; left: -10px;
        transform: rotate(-70deg);
        opacity: 0.8;
    }
    .gemini-sparkle-logo::after { /* Sparkle kecil tambahan */
        width: 15px; height: 15px;
        border-radius: 50%;
        top: 5px; right: -20px;
        transform: scale(0.6) rotate(45deg);
        opacity: 0.7;
    }
    ```
*   **`chat-container` & `main` Styling & Animasi (SANGAT PENTING):**
    ```css
    main {
        flex-grow: 1; /* Memenuhi sisa ruang */
        display: flex; /* Flexbox untuk menata chat-container, loading, error */
        flex-direction: column;
        position: relative; /* Untuk loading/error absolut */
        overflow: hidden; /* Mencegah scroll yang tidak diinginkan dari chat-container */
        padding-bottom: 80px; /* Memberikan ruang di bawah untuk input-area fixed */
    }
    #chat-container {
        flex-grow: 1;
        overflow-y: auto; /* Memungkinkan scroll saat pesan banyak */
        padding: 20px;
        display: flex;
        flex-direction: column;
        gap: 10px; /* Spasi antar gelembung pesan */
        background: var(--primary-bg);
        opacity: 0; /* Awalnya tersembunyi */
        transform: translateY(20px); /* Posisi awal untuk animasi slide-up */
        transition: opacity 0.5s ease-out, transform 0.5s ease-out; /* Animasi muncul */
        will-change: opacity, transform; /* Optimalisasi animasi */
        visibility: hidden; /* Sembunyikan sepenuhnya di awal */
    }
    #chat-container.visible { /* Kelas ini ditambahkan JS saat muncul */
        opacity: 1;
        transform: translateY(0);
        visibility: visible;
    }
    ```
*   **Chat Messages (`.message`, `.user-message`, `.model-message`):**
    ```css
    .message {
        max-width: 80%; /* Batasi lebar gelembung pesan */
        padding: 12px 18px;
        border-radius: 18px; /* Sudut membulat */
        line-height: 1.6;
        position: relative;
        word-wrap: break-word; /* Memastikan teks panjang pecah baris */
        box-shadow: 0 1px 3px rgba(0,0,0,0.08); /* Bayangan lembut, efek elevasi */
        opacity: 0; /* Default untuk animasi muncul */
        transform: translateY(15px); /* Posisi awal untuk animasi slide-up */
        animation: message-appear 0.3s ease-out forwards; /* Diterapkan via JS saat dirender */
    }
    @keyframes message-appear { /* Animasi untuk pesan baru */
        from { opacity: 0; transform: translateY(15px); }
        to { opacity: 1; transform: translateY(0); }
    }

    .user-message {
        background: var(--bubble-user-bg);
        align-self: flex-end; /* Rata kanan untuk pengguna */
        border-bottom-right-radius: 4px; /* Sudut lancip di kanan bawah */
        color: var(--text-color-dark);
    }
    .model-message {
        background: var(--bubble-model-bg);
        align-self: flex-start; /* Rata kiri untuk AI */
        border-bottom-left-radius: 4px; /* Sudut lancip di kiri bawah */
        color: var(--text-color-dark);
    }
    .message img { /* Gambar di dalam pesan */
        max-width: 100%;
        height: auto;
        border-radius: 8px;
        margin-top: 8px;
        display: block;
    }
    ```
*   **`input-area` Styling & Posisi (SANGAT KRUSIAL):**
    ```css
    #input-area {
        position: fixed; /* Selalu di bagian bawah viewport */
        bottom: 0;
        left: 0;
        right: 0;
        width: 100%;
        background: var(--secondary-bg);
        padding: 15px 20px;
        border-top: 1px solid var(--border-color);
        display: flex;
        align-items: flex-end; /* Agar textarea menyesuaikan tinggi input-area */
        gap: 10px;
        box-shadow: 0 -2px 5px rgba(0,0,0,0.03); /* Bayangan lembut */
        z-index: 90;
        opacity: 0; /* Awalnya tersembunyi */
        transform: translateY(20px); /* Posisi awal untuk animasi slide-up */
        transition: opacity 0.3s ease-out, transform 0.3s ease-out; /* Animasi muncul */
        will-change: opacity, transform; /* Optimalisasi animasi */
        visibility: hidden; /* Sembunyikan sepenuhnya di awal */
    }
    #input-area.visible { /* Kelas ini ditambahkan JS saat muncul */
        opacity: 1;
        transform: translateY(0);
        visibility: visible;
    }

    #user-input {
        flex-grow: 1; /* Memenuhi ruang yang tersedia */
        padding: 12px 18px;
        border: 1px solid var(--border-color);
        border-radius: 24px; /* Sangat bulat */
        resize: none; /* Nonaktifkan resize manual */
        overflow-y: auto; /* Aktifkan scroll vertikal jika teks panjang */
        max-height: 120px; /* Batasi tinggi maksimum textarea */
        font-size: 16px;
        line-height: 1.5;
        color: var(--text-color-dark);
        transition: border-color 0.2s ease, box-shadow 0.2s ease; /* Transisi halus saat fokus */
        outline: none; /* Hapus outline default browser */
    }
    #user-input:focus {
        border-color: var(--accent-color);
        box-shadow: 0 0 0 3px rgba(66, 133, 244, 0.15); /* Ringan, soft glow saat fokus */
    }
    ```
*   **Tombol (Send, File Upload) - Ikon Profesional & Minimalis:**
    ```css
    .icon-button {
        width: 48px; /* Ukuran standar tombol ikon */
        height: 48px;
        border-radius: 50%; /* Bentuk bulat */
        display: flex; /* Flexbox untuk centering ikon */
        justify-content: center;
        align-items: center;
        cursor: pointer;
        transition: background 0.2s ease, transform 0.2s ease; /* Animasi hover/klik */
        border: none;
        font-size: 20px; /* Ukuran font untuk Unicode agar pas di tengah */
        line-height: 1; /* Pastikan vertikal tengah untuk Unicode */
        text-decoration: none; /* Untuk label sebagai tombol */
    }
    .icon-button:hover:not(:disabled) {
        transform: scale(1.05); /* Sedikit membesar saat hover */
    }
    .icon-button:disabled {
        opacity: 0.6; /* Kusam saat disabled */
        cursor: not-allowed;
    }

    .send-button {
        background: var(--accent-color);
        color: white;
    }
    .send-button:hover:not(:disabled) {
        background: var(--accent-color-dark); /* Sedikit lebih gelap saat hover */
    }

    .upload-button {
        background: var(--bubble-model-bg); /* Warna abu-abu terang */
        color: var(--text-color-dark);
    }
    .upload-button:hover:not(:disabled) {
        background: #e9e9eb; /* Sedikit lebih gelap saat hover */
    }

    .clear-preview-button { /* Tombol 'X' untuk hapus preview */
        position: absolute;
        top: -10px; /* Posisi di luar container */
        right: -10px;
        background: var(--text-color-light); /* Warna abu-abu gelap */
        color: white;
        width: 24px; /* Ukuran kecil */
        height: 24px;
        font-size: 16px;
        line-height: 1;
        padding-top: 2px; /* Untuk centering 'x' */
        z-index: 5; /* Pastikan di atas gambar preview */
    }
    ```
*   **`image-preview-container` Styling & Animasi:**
    ```css
    #image-preview-container {
        background: var(--secondary-bg);
        padding: 10px;
        border-radius: 15px;
        margin-bottom: 10px;
        display: flex; /* Flex agar gambar dan tombol 'X' bisa diatur */
        align-items: center;
        gap: 10px;
        position: fixed; /* Di atas input-area */
        bottom: 85px; /* (height of input-area + some margin) */
        left: 20px; /* Posisi di kiri */
        box-shadow: 0 2px 8px rgba(0,0,0,0.1); /* Bayangan halus */
        z-index: 80; /* Di bawah input-area, di atas chat */
        opacity: 0; /* Awalnya tersembunyi */
        transform: translateY(10px); /* Posisi awal untuk animasi slide-up */
        transition: opacity 0.3s ease-out, transform 0.3s ease-out; /* Animasi muncul */
        visibility: hidden; /* Sembunyikan sepenuhnya saat tidak digunakan */
        max-width: calc(100% - 40px); /* Batasi lebar agar tidak terlalu lebar */
        will-change: opacity, transform, visibility;
    }
    #image-preview-container.visible { /* Kelas ini ditambahkan JS saat muncul */
        opacity: 1;
        transform: translateY(0);
        visibility: visible;
    }
    #image-preview {
        max-width: 80px;
        max-height: 80px;
        object-fit: cover;
        border-radius: 8px;
    }
    ```
*   **`loading-indicator` (AI Typing...) Styling & Animasi:**
    ```css
    #loading-indicator {
        display: none; /* Sembunyikan default */
        align-self: flex-start; /* Sejajar dengan pesan AI */
        background: var(--bubble-model-bg);
        padding: 12px 18px;
        border-radius: 18px;
        border-bottom-left-radius: 4px; /* Sudut lancip */
        margin: 0 0 10px 0; /* Margin bawah untuk spasi */
        box-shadow: 0 1px 3px rgba(0,0,0,0.08);
        animation: message-appear 0.3s ease-out forwards; /* Saat muncul */
        font-size: 16px;
        color: var(--text-color-light);
        width: fit-content; /* Sesuai konten */
        white-space: nowrap; /* Jangan pecah baris */
    }
    #loading-indicator span.dot {
        display: inline-block;
        width: 8px; height: 8px;
        border-radius: 50%;
        background-color: var(--text-color-light);
        margin: 0 2px;
        animation: dot-pulse 0.8s infinite ease-in-out;
    }
    #loading-indicator span.dot:nth-child(2) { animation-delay: 0.1s; }
    #loading-indicator span.dot:nth-child(3) { animation-delay: 0.2s; }

    @keyframes dot-pulse {
        0%, 100% { transform: translateY(0); opacity: 0.6; }
        50% { transform: translateY(-4px); opacity: 1; }
    }
    ```
*   **Error Message Area Styling:**
    ```css
    #error-message-area {
        background: var(--error-bg);
        color: var(--error-color);
        padding: 10px;
        border-radius: 8px;
        margin: 10px 20px; /* Margin samping */
        text-align: center;
        font-size: 14px;
        opacity: 0;
        transition: opacity 0.3s ease-out;
        visibility: hidden; /* Sembunyikan sepenuhnya */
        position: absolute; /* Posisikan di atas chat, tapi di bawah input */
        bottom: 95px; /* (height of input-area + preview height + some margin) */
        width: calc(100% - 40px); /* Sesuaikan lebar */
        left: 20px;
        z-index: 70;
    }
    #error-message-area.visible {
        opacity: 1;
        visibility: visible;
    }
    ```
*   **Responsif Dasar:**
    ```css
    @media (max-width: 600px) {
        header h1 { font-size: 20px; }
        #welcome-screen h1 { font-size: 28px; }
        #welcome-screen .welcome-message-text { font-size: 16px; }
        #chat-container { padding: 15px; }
        .message { max-width: 90%; padding: 10px 15px; font-size: 15px; }
        #input-area { padding: 10px 15px; }
        #user-input { font-size: 15px; padding: 10px 15px; }
        .icon-button { width: 40px; height: 40px; font-size: 18px; }
        #image-preview-container { bottom: 75px; left: 15px; width: calc(100% - 30px); }
        #error-message-area { bottom: 80px; left: 15px; width: calc(100% - 30px); }
    }
    ```

### 3.3. `public/script.js` - Fokus pada ALUR & Konsistensi State (SANGAT TELITI)

*   **State Management & DOM Element References:**
    ```javascript
    // === DOM References ===
    const welcomeScreen = document.getElementById('welcome-screen');
    const chatContainer = document.getElementById('chat-container');
    const inputArea = document.getElementById('input-area');
    const userInput = document.getElementById('user-input');
    const sendButton = document.getElementById('send-button');
    const imageUpload = document.getElementById('image-upload');
    const imagePreviewContainer = document.getElementById('image-preview-container');
    const imagePreview = document.getElementById('image-preview');
    const clearImagePreviewButton = document.getElementById('clear-image-preview');
    const loadingIndicator = document.getElementById('loading-indicator');
    const errorMessageArea = document.getElementById('error-message-area');

    // === Application State ===
    // 'messages' array akan menyimpan riwayat percakapan secara lengkap (teks dan gambar base64)
    // Format: [{ role: "user"|"model", parts: [{ text: "...", mimeType: "...", data: "..." }] }]
    const messages = [];
    let selectedImageFile = null; // Menyimpan File object untuk gambar yang akan diunggah
    ```
*   **Alur UI Utama (SANGAT KRUSIAL untuk Pengalaman Mulus):**
    ```javascript
    // === Initial UI Setup on Load ===
    document.addEventListener('DOMContentLoaded', () => {
        // Atur status awal elemen UI
        welcomeScreen.classList.remove('hidden'); // Pastikan welcome screen terlihat
        welcomeScreen.style.display = 'flex'; // Pastikan display type benar

        chatContainer.classList.remove('visible'); // Sembunyikan chat container
        chatContainer.style.display = 'flex'; // Tetap atur display flex agar transisi bisa berjalan

        inputArea.classList.remove('visible'); // Sembunyikan input area
        inputArea.style.display = 'flex'; // Tetap atur display flex

        loadingIndicator.style.display = 'none'; // Sembunyikan loading
        errorMessageArea.classList.remove('visible'); // Sembunyikan error
        errorMessageArea.style.display = 'none'; // Sembunyikan juga display
        imagePreviewContainer.classList.remove('visible'); // Sembunyikan preview gambar
        imagePreviewContainer.style.display = 'none'; // Sembunyikan juga display
    });

    // === Fungsi untuk Menampilkan UI Chat dan Menyembunyikan Welcome Screen ===
    // Fungsi ini dipanggil HANYA SEKALI, setelah respons pertama dari Gemini diterima.
    function showChatUI() {
        if (!welcomeScreen.classList.contains('hidden')) { // Pastikan belum pernah disembunyikan
            welcomeScreen.classList.add('hidden'); // Memicu animasi hide pada welcome screen
            setTimeout(() => {
                welcomeScreen.style.display = 'none'; // Sembunyikan sepenuhnya setelah transisi selesai

                chatContainer.classList.add('visible'); // Memicu animasi show pada chat container
                chatContainer.style.display = 'flex'; // Pastikan display type benar

                inputArea.classList.add('visible'); // Memicu animasi show pada input area
                inputArea.style.display = 'flex'; // Pastikan display type benar

                autoScrollChat(); // Gulir ke bawah
            }, 500); // Sesuaikan dengan durasi transisi CSS welcome-screen (0.5s)
        }
    }
    ```
*   **`renderMessage(message)` Function - Dengan Animasi CSS:**
    ```javascript
    // === Fungsi untuk Merender Pesan ke UI ===
    function renderMessage(message) {
        const messageDiv = document.createElement('div');
        messageDiv.classList.add('message', message.role + '-message');

        // Render setiap 'part' dalam pesan (teks atau gambar)
        message.parts.forEach(part => {
            if (part.text) {
                const p = document.createElement('p');
                p.textContent = part.text;
                messageDiv.appendChild(p);
            }
            if (part.mimeType && part.data) {
                const img = document.createElement('img');
                // Gambar dari riwayat akan berupa base64. Gambar baru akan berupa blob URL.
                img.src = part.data.startsWith('data:') ? part.data : `data:${part.mimeType};base64,${part.data}`;
                img.alt = (part.text || 'Image') + ' provided by ' + message.role;
                messageDiv.appendChild(img);
            }
        });

        chatContainer.appendChild(messageDiv);

        // Memicu animasi CSS 'message-appear' setelah elemen ditambahkan ke DOM
        // Menggunakan setTimeout 10ms untuk memastikan reflow DOM
        setTimeout(() => {
            messageDiv.style.opacity = '1';
            messageDiv.style.transform = 'translateY(0)';
        }, 10);

        autoScrollChat(); // Gulir otomatis ke bawah
    }
    ```
*   **`sendMessage()` Function (Async - ALUR LOGIKA SANGAT TELITI):**
    ```javascript
    // === Fungsi Utama untuk Mengirim Pesan ===
    async function sendMessage() {
        const promptText = userInput.value.trim();

        // 1. Validasi Input
        if (!promptText && !selectedImageFile) {
            errorMessageArea.innerText = 'Mohon masukkan pesan teks atau unggah gambar.';
            errorMessageArea.classList.add('visible');
            errorMessageArea.style.display = 'block'; // Pastikan display block
            return;
        } else {
            errorMessageArea.classList.remove('visible');
            errorMessageArea.style.display = 'none';
        }

        // 2. Tampilkan Pesan Pengguna di UI Segera
        const userMessagePartsForUI = [];
        if (promptText) {
            userMessagePartsForUI.push({ text: promptText });
        }
        let currentImageBase64ForHistory = null;
        if (selectedImageFile) {
            // Untuk menampilkan gambar yang baru diunggah di UI chat
            const tempImageUrl = URL.createObjectURL(selectedImageFile);
            userMessagePartsForUI.push({ mimeType: selectedImageFile.type, data: tempImageUrl });
            
            // Untuk backend, kita perlu base64-nya sekarang
            try {
                currentImageBase64ForHistory = await fileToBase64(selectedImageFile);
            } catch (error) {
                console.error("Failed to convert current image to Base64:", error);
                errorMessageArea.innerText = `Gagal mengunggah gambar. Detail: ${error.message}`;
                errorMessageArea.classList.add('visible');
                errorMessageArea.style.display = 'block';
                return;
            }
        }
        renderMessage({ role: 'user', parts: userMessagePartsForUI });

        // 3. UI Feedback (Awal):
        loadingIndicator.style.display = 'flex'; // Tampilkan indikator loading
        sendButton.disabled = true; // Nonaktifkan tombol kirim
        userInput.disabled = true; // Nonaktifkan input
        imageUpload.disabled = true; // Nonaktifkan unggah gambar

        userInput.value = ''; // Kosongkan textarea
        clearImagePreview(); // Hapus preview gambar

        try {
            const formData = new FormData();
            formData.append('prompt', promptText);

            // 4. Serialisasi Riwayat `messages` ke JSON string untuk Backend (SANGAT PENTING):
            // Frontend harus mengirimkan SELURUH riwayat percakapan (termasuk gambar yang sudah diunggah sebelumnya)
            // dalam format yang bisa di-parse backend Go.
            const formattedMessagesHistoryForBackend = await Promise.all(messages.map(async msg => {
                const newParts = await Promise.all(msg.parts.map(async part => {
                    // Jika part adalah gambar dan URL-nya adalah blob: (gambar yang diunggah sebelumnya oleh user)
                    if (part.mimeType && part.data && part.data.startsWith('blob:')) {
                        try {
                            // Konversi blob URL kembali ke Base64 untuk dikirim ke backend
                            const response = await fetch(part.data);
                            const blob = await response.blob();
                            const base64Data = await fileToBase64(blob);
                            return { text: part.text, mimeType: part.mimeType, data: base64Data.split(',')[1] }; // Ambil hanya data base64
                        } catch (error) {
                            console.error("Failed to convert blob URL to base64 for history:", error);
                            // Jika gagal konversi, kirim part teks saja atau abaikan gambar historis tersebut
                            return { text: part.text };
                        }
                    }
                    // Jika part adalah teks atau gambar yang sudah base64 dari respons AI
                    return part;
                }));
                return { role: msg.role, parts: newParts };
            }));

            // Tambahkan pesan pengguna saat ini ke riwayat yang akan dikirim ke backend
            const currentUserTurnParts = [];
            if (promptText) {
                currentUserTurnParts.push({ text: promptText });
            }
            if (currentImageBase64ForHistory) {
                currentUserTurnParts.push({ mimeType: selectedImageFile.type, data: currentImageBase64ForHistory.split(',')[1] });
            }
            formattedMessagesHistoryForBackend.push({ role: 'user', parts: currentUserTurnParts });
            
            formData.append('messages', JSON.stringify(formattedMessagesHistoryForBackend));

            // 5. Lampirkan File Gambar Saat Ini (jika ada) ke FormData
            if (selectedImageFile) {
                // Untuk upload file saat ini, append File object secara langsung ke field 'image'
                formData.append('image', selectedImageFile);
            }

            // 6. Kirim Request ke Backend Go
            const response = await fetch('/api/chat', {
                method: 'POST',
                body: formData // FormData akan mengatur Content-Type secara otomatis
            });
            const data = await response.json(); // Mengurai respons JSON dari backend

            // 7. Tangani Respons dari Backend
            if (data.error) {
                errorMessageArea.innerText = `Error: ${data.error}`;
                errorMessageArea.classList.add('visible');
                errorMessageArea.style.display = 'block';
                console.error("Backend Error:", data.error);
                // Opsional: Hapus pesan pengguna yang baru dikirim dari riwayat jika gagal respons
                // messages.pop(); 
            } else {
                // PENTING: Panggil showChatUI() HANYA JIKA ini adalah respons pertama dari Gemini
                if (messages.length === 0) { // Asumsi pesan sambutan AI adalah yang pertama
                    showChatUI(); 
                }
                
                // Tambahkan respons AI ke array `messages` frontend
                messages.push({ role: 'model', parts: [{ text: data.response }] });
                renderMessage({ role: 'model', parts: [{ text: data.response }] });
            }

        } catch (error) {
            // Tangani error jaringan atau error JavaScript umum
            console.error("Fetch Error:", error);
            errorMessageArea.innerText = `Terjadi kesalahan jaringan atau server. Mohon coba lagi. Detail: ${error.message}`;
            errorMessageArea.classList.add('visible');
            errorMessageArea.style.display = 'block';
        } finally {
            // 8. Bersihkan UI Feedback (Akhir)
            loadingIndicator.style.display = 'none'; // Sembunyikan loading
            sendButton.disabled = false; // Aktifkan tombol kirim
            userInput.disabled = false; // Aktifkan input
            imageUpload.disabled = false; // Aktifkan unggah gambar
            autoScrollChat(); // Gulir ulang ke bawah
        }
    }
    ```
*   **Event Listeners:**
    ```javascript
    // === Event Listeners ===
    sendButton.addEventListener('click', sendMessage);

    userInput.addEventListener('keypress', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) { // Kirim saat Enter ditekan (bukan Shift+Enter)
            e.preventDefault(); // Mencegah baris baru di textarea
            sendMessage();
        }
    });

    imageUpload.addEventListener('change', (e) => {
        selectedImageFile = e.target.files[0];
        if (selectedImageFile) {
            const reader = new FileReader();
            reader.onload = (event) => {
                imagePreview.src = event.target.result;
                imagePreviewContainer.classList.add('visible'); // Tampilkan preview dengan animasi
                imagePreviewContainer.style.display = 'flex'; // Pastikan display type
                autoScrollChat(); // Gulir ke bawah agar preview terlihat
            };
            reader.readAsDataURL(selectedImageFile);
        } else {
            clearImagePreview();
        }
    });

    clearImagePreviewButton.addEventListener('click', () => {
        clearImagePreview();
    });
    ```
*   **Helper Functions:**
    ```javascript
    // === Helper Functions ===

    // Untuk menghapus gambar preview dan mereset input file
    function clearImagePreview() {
        selectedImageFile = null;
        imageUpload.value = ''; // Reset input file agar bisa memilih file yang sama lagi
        imagePreview.src = '';
        imagePreviewContainer.classList.remove('visible'); // Sembunyikan preview dengan animasi
        setTimeout(() => {
            imagePreviewContainer.style.display = 'none'; // Sembunyikan sepenuhnya setelah animasi
        }, 300); // Sesuaikan dengan durasi transisi CSS
    }

    // Untuk menggulir chat ke bagian paling bawah
    function autoScrollChat() {
        chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    // Helper untuk mengkonversi File/Blob menjadi Base64 string
    function fileToBase64(file) {
        return new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.onloadend = () => resolve(reader.result); // result adalah data URL (data:mimeType;base64,...)
            reader.onerror = reject;
            reader.readAsDataURL(file);
        });
    }

    // === Inisialisasi Awal Pesan AI (Ini PENTING untuk memicu alur UI) ===
    // Panggil sendMessage() sekali saat aplikasi dimuat untuk mendapatkan pesan sambutan dari AI
    // dan memicu transisi UI dari welcome screen ke chat.
    // Kirim prompt kosong atau "Halo" untuk memulai percakapan dan mendapatkan sambutan.
    setTimeout(() => { // Memberi waktu DOM untuk render
        userInput.value = "Halo"; // Berikan prompt awal yang akan dikirim
        sendMessage();
    }, 100); // Penundaan singkat untuk memastikan DOM siap
    ```

---

## 4. Instruksi Pengguna Akhir (Tambahan di Readme/Komentar Kode)

*   **Pentingnya API Key:** Ingatkan lagi tentang cara mendapatkan `GEMINI_API_KEY` dari [Google AI Studio](https://aistudio.google.com/) dan cara menambahkannya ke Replit Secrets. **Ini adalah penyebab paling umum dari kegagalan API.**
*   **Menjalankan Aplikasi:** Jelaskan bahwa Replit akan secara otomatis mendeteksi dan menjalankan aplikasi Go dengan `go run main.go`.
*   **Keterbatasan Gemini:** Tekankan kembali bahwa Google Gemini **tidak menghasilkan gambar dari teks**, melainkan **menganalisis dan memahami** gambar yang diberikan.

---

Prompt ini mencakup detail yang sangat spesifik, terutama pada bagian JavaScript untuk mengelola state dan transisi UI dengan halus, serta penanganan `multipart/form-data` dan Base64 untuk riwayat percakapan. Ini adalah instruksi yang sangat menantang, jadi proses generasinya mungkin akan memakan waktu.

**Setelah Replit AI Agent selesai membuat kode:**

1.  **Pastikan `GEMINI_API_KEY` Anda sudah disetel di Replit Secrets.**
2.  **Jalankan aplikasi Anda di Replit.**
3.  **PERIKSA LOG REPLIT DI TAB KONSOL GO ANDA DENGAN TELITI** jika masih ada bug atau pesan error.
4.  **PERIKSA KONSOL BROWSER ANDA (Developer Tools)** untuk error JavaScript atau masalah terkait CSS/animasi.

Saya berharap ini memberikan hasil yang maksimal dan sesuai dengan ekspektasi Anda. Saya menantikan kabar baik!